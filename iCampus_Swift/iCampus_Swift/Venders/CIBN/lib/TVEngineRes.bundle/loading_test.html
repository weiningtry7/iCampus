<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"> 
<meta name="viewport" content="height=device-height,initial-scale=1, maximum-scale=1">
<title></title>

<!-- <script src="adController_android.js"></script> -->
<style type="text/css">
* { padding:0; margin:0;}
body{
margin:0px auto;
}
.poster {
    vertical-align:middle;
    width:100%;
    max-height:100%;
    max-width:100%;
    height:100%;
}
.con_div{
width: 100%;
text-align:center;
vertical-align:middle;
color:#000;
}
.iframeDiv{
position:absolute;
filter:alpha(Opacity=80);
z-index:100;
width:100%;
height:100%;
}
.float_div{
position:absolute;
float:right;
z-index:100;
width:75px;
height:75px;
right:0;
top:0;
background-image:url(http://ad-cache.dopool.com/ad/AdSale/html_api/bg_video_ad_timer.png);
}
.vip_div{
position:absolute;
float:right;
z-index:100;
width:75px;
height:75px;
right:0;
top:0;
margin-right: 75px;
}
.vip_con{   
position:absolute;
z-indent:2;
left:0;
top:0;
}
.close_div{
position:absolute;
float:right;
z-index:100;
right:0;
top:0;
text-align: right;
}
.back{
position:absolute;
float:left;
z-index:100;
left:0;
top:0;
}
.timer{
color:#fff;    
position:absolute;
z-indent:2;
left:0;
top:0;
}
#ad_img_wrapper{
    width:100%;
    height:100%;
}

</style>
</head>
<body>
    <div class="con_div" id="con_div">
        <div class="back" onclick="AdJsServerController.goback()" style='display:none'>
            <div id="" class="timer">
                    <img id="backImg" src="http://ad-cache.dopool.com/ad/AdSale/html_api/back_from_video_ad.png">
            </div>
        </div>
        <!--
        <div id="vip_div" class="vip_div" style="display:none" >
            <a href="javascript:AdInterface.blockAd()">
                <img id="vip_img" src="http://ad-cache.dopool.com/ad/AdSale/html_api/blockad.png">
            </a>
        </div>
        -->
        <div id="float_div" class="float_div" style='display:none'>
                <div id="timer" class="timer">5</div>
        </div>
        <div id="close" class="close_div" style='display:none'>
                <img id="close_img" onclick="AdJsServerController.closeImg()" src="http://ad-cache.dopool.com/ad/AdSale/html_api/close.png">
        </div>
        <div onclick="AdJsServerController.downloadapp()" id="iframeDiv" class="iframeDiv" style="display:none;"></div>
        <iframe id="iframe" width="100%" height="100%" style="display:none" src=""></iframe>
        <div id="ad_img_wrapper"></div>
        <img style="display:none" id="start_ad_img" src="" class="poster" >
        <input id="ad_location" type="hidden" value="">
        <input id="app_name" type="hidden" value="">
        <input id="app_iscancel" type="hidden" value="">
        <input id="location_type" type="hidden" value="">
        <input id="user_imp" type="hidden" value="">
        <input id="user_clk" type="hidden" value="">
        <input id="third_imp" type="hidden" value="">
        <input id="third_clk" type="hidden" value="">
        <input id="sm_clk" type="hidden" value="">
        <input id="orderid" type="hidden" value="">
        <input id="order_params" type="hidden" value="">
    </div>
</body>
<script>
//测试数据

// var AdInterface = {
// getPhoneInfo:function(){
//     return '{"uuid":"FD84A665-F748-4E22-9ACE-199EDBEF1569","imsi":"","mac":"02:00:00:00:00:00","net":"WIFI","appver":"6.2.1","deviceId":"0","reslevel":3,"platform":"apple","osver":"9.2.1","manufacturer":"apple","resolution":"1242x2208","dmodel":"iPhone","app_key":"4MUAHmQFf1YR"}';
// },
// getDataCache:function(key){
//     res=localStorage.getItem(key);
//     return res;
// },
// setDataCache:function(key,value){
//     localStorage.setItem(key,value);

// },
// removeDataCache:function(key){
//     localStorage.removeItem(key);
// },
// dowloadApp:function(){

// },
// openNewTablet:function(str,url,num){
// console.log('openUrl'+url)
// },
// back:function(){
// console.log('back')
// },
// show:function(){
// console.log('show')
// },
// hide:function(){
// console.log('hide')
// },
// getHdtData:function(){

// },
// getApi:function(url,method,params,headers,timeout){
//     return '{"errorData":[{"ERROR":{"ads":[],"requestId":"ea077e59-0156-1000-eb00-fa8000000090"},"PARAMS":{"orderid":"8018","adtype":"inmobi_loading"}}],"successData":{"DATA":{"ads":[{"pubContent":"eyJ0aXRsZSI6Ik5vcm1hbCBVcmwgdGVzdCIsInNjcmVlbnNob3RzIjp7IndpZHRoIjoxMjgwLCJoZWlnaHQiOjcyMCwidXJsIjoiaHR0cHM6Ly9pLmwuaW5tb2JpY2RuLm5ldC9hc3NldHMvMmQ4ZTI2NTlmZjJiNDE0Yzk4OGNjNWYxZGExM2QwMTYuanBlZyIsImFzcGVjdFJhdGlvIjoxLjc3fSwibGFuZGluZ1VSTCI6Imh0dHA6Ly93d3cuc2Ftc3VuZy5jb20vdWsvaG9tZSIsImN0YSI6Ik9wZW4ifQ==","beaconUrl":"https://et.w.inmobi.com/c.asm/C/t/ei18ts9u9z/vcw/s/4k/lx/u/0/0/0/eyJVSUQiOiI0MDFGNkQ1Qi01REZCLTQ5QTktOEEzRi05QUJFRDhFMTNGM0UiLCJJREEiOiI0MDFGNkQ1Qi01REZCLTQ5QTktOEEzRi05QUJFRDhFMTNGM0UifQ~~/e9dc0f9e-0156-1000-eded-3e9c49870093/-1/0/-1/0/1/x/11041352/NW/2t/0/api/3.0.0/dir/Y29tLmRvcG9vbC5kb3BUVg~~/FsDPJCas9f3p31W4Bk5BVElWRRwUABQCHBwW_7_P6r-Y-KMsFtmt-KeQ2eDuJAAWkPDbtayAlOUsFQASAAA5BSEUADgcc2FuZGJveGFkc2VydmVyMTAwMS5wc28uaGtnMRQCEjwVAgAsFQIAUwYA/-1/AA/6/821fe0b3","eventTracking":{"1":{"urls":["https://et.w.inmobi.com/c.asm/C/t/ei18ts9u9z/vcw/s/4k/lx/u/0/0/0/eyJVSUQiOiI0MDFGNkQ1Qi01REZCLTQ5QTktOEEzRi05QUJFRDhFMTNGM0UiLCJJREEiOiI0MDFGNkQ1Qi01REZCLTQ5QTktOEEzRi05QUJFRDhFMTNGM0UifQ~~/e9dc0f9e-0156-1000-eded-3e9c49870093/-1/0/-1/0/1/x/11041352/NW/2t/0/api/3.0.0/dir/Y29tLmRvcG9vbC5kb3BUVg~~/FsDPJCas9f3p31W4Bk5BVElWRRwUABQCHBwW_7_P6r-Y-KMsFtmt-KeQ2eDuJAAWkPDbtayAlOUsFQASAAA5BSEUADgcc2FuZGJveGFkc2VydmVyMTAwMS5wc28uaGtnMRQCEjwVAgAsFQIAUwYA/-1/AA/6/821fe0b3?m=1&amp;ts=$TS"]},"8":{"urls":["https://et.w.inmobi.com/c.asm/C/t/ei18ts9u9z/vcw/s/4k/lx/u/0/0/0/eyJVSUQiOiI0MDFGNkQ1Qi01REZCLTQ5QTktOEEzRi05QUJFRDhFMTNGM0UiLCJJREEiOiI0MDFGNkQ1Qi01REZCLTQ5QTktOEEzRi05QUJFRDhFMTNGM0UifQ~~/e9dc0f9e-0156-1000-eded-3e9c49870093/-1/0/-1/0/1/x/11041352/NW/2t/0/api/3.0.0/dir/Y29tLmRvcG9vbC5kb3BUVg~~/FsDPJCas9f3p31W4Bk5BVElWRRwUABQCHBwW_7_P6r-Y-KMsFtmt-KeQ2eDuJAAWkPDbtayAlOUsFQASAAA5BSEUADgcc2FuZGJveGFkc2VydmVyMTAwMS5wc28uaGtnMRQCEjwVAgAsFQIAUwYA/-1/AA/6/821fe0b3?m=8&amp;ts=$TS","https://c.w.inmobi.com/c.asm/C/t/ei18ts9u9z/vcw/s/4k/lx/u/0/0/0/eyJVSUQiOiI0MDFGNkQ1Qi01REZCLTQ5QTktOEEzRi05QUJFRDhFMTNGM0UiLCJJREEiOiI0MDFGNkQ1Qi01REZCLTQ5QTktOEEzRi05QUJFRDhFMTNGM0UifQ~~/e9dc0f9e-0156-1000-eded-3e9c49870093/-1/0/-1/1/1/x/11041352/NW/2t/0/api/3.0.0/dir/Y29tLmRvcG9vbC5kb3BUVg~~/FsDPJCas9f3p31W4Bk5BVElWRRwUABQCHBwW_7_P6r-Y-KMsFtmt-KeQ2eDuJAAWkPDbtayAlOUsFQASAAA5BSEUADgcc2FuZGJveGFkc2VydmVyMTAwMS5wc28uaGtnMRQCEjwVAgAsFQIAUwYA/-1/AA/6/f528655e?at=1&amp;am=0&amp;ct=$TS"]},"18":{"urls":["https://et.w.inmobi.com/c.asm/C/t/ei18ts9u9z/vcw/s/4k/lx/u/0/0/0/eyJVSUQiOiI0MDFGNkQ1Qi01REZCLTQ5QTktOEEzRi05QUJFRDhFMTNGM0UiLCJJREEiOiI0MDFGNkQ1Qi01REZCLTQ5QTktOEEzRi05QUJFRDhFMTNGM0UifQ~~/e9dc0f9e-0156-1000-eded-3e9c49870093/-1/0/-1/0/1/x/11041352/NW/2t/0/api/3.0.0/dir/Y29tLmRvcG9vbC5kb3BUVg~~/FsDPJCas9f3p31W4Bk5BVElWRRwUABQCHBwW_7_P6r-Y-KMsFtmt-KeQ2eDuJAAWkPDbtayAlOUsFQASAAA5BSEUADgcc2FuZGJveGFkc2VydmVyMTAwMS5wc28uaGtnMRQCEjwVAgAsFQIAUwYA/-1/AA/6/821fe0b3?m=18&amp;ts=$TS"]},"120":{"urls":["https://au.w.inmobi.com/c.asm/C/-1/ei18ts9u9z/vcw/s/4k/lx/u/0/0/0/-1/e9dc0f9e-0156-1000-ed91-3e9b7d80f493/-1/0/-1/0/1/x/-1/NW/-1/0/api/3.0.0/dir/Y29tLmRvcG9vbC5kb3BUVg~~/BCoCOBxzYW5kYm94YWRzZXJ2ZXIxMDAxLnBzby5oa2cxAA/-1/HBb_v8_qv5j4oywW2a34p5DZ4O4kABbAzyQWrPX96d9VFpDw27WsgJTlLBUAFQIYBk5BVElWRQA/6/43214ce4?m=120&amp;ts=$TS"]}},"landingPage":"http://www.samsung.com/uk/home"}],"requestId":"e9dc0f2b-0156-1000-f800-fa8000000090"},"ORIGIN_LOCATION":"","CUSTOM_CLICK":"","DAY_NUM":"0","PRIORITY":"0","APP_NAME":"","MARKET":"","APP_ISCANCEL":"","DURATION":"3","VIDEOIDS":"369,368,366,363,362","STATISTURL":"http://test.adapi.starschina.com/ad/Adv/api.php","IMPR_URL":{},"PARAMS":{"orderid":"8018","adtype":"inmobi_loading"},"CLICK_URL":{},"CUSTOM_SHOW":"","ORDER":"1","SHOWIDS":"","TYPE":"INMOBI_LOADING"}}';

// },
// noAds:function(){
// alert('noads')
// },
// sendAdData:function(dataApi,eventName,adParams){
// console.log(dataApi+'--'+eventName+'--'+adParams);
// },
// getCurrentPlay:function(){
//    return '{"screen":"598.0X360.0","params":{"videoId":"362","videoType":"1"},"name":"ActivePlayerViewController"}';
// },
// showAds:function(show){
//   alert(show)
// },
// getIflyTek:function(){
//   return 'undefined'; 
// }
// }


var api_url="http://test.adapi.starschina.com/Adv/api.php";
//var api_url="http://adapi.starschina.com/ad/Adv/api.php";
var dataApi="http://ad-data.starschina.com";
var minAppver='6.3';
var appver;
var myDate = new Date();
var year=myDate.getFullYear();
var month=myDate.getMonth();
var day=myDate.getDate();
var adDate=year+'-'+month+'-'+day;
var adInfo;
var thirdTrack={};
var show_time;
var madhouseAid='DB728EA8C2DD7135';
var $ = function (selector) {
    var obj;
    var isclass=false;
    var str=selector.substr(1);
    if(selector.indexOf(".")>=0){
        isclass=true;
        obj=document.getElementsByClassName(str);
    }else{
        obj=document.getElementById(str);
    }
    //console.log(obj)
    var jquery={
        "val":function(){
            if(arguments[0]!=undefined){
                obj.value=arguments[0];
            }
            return obj.value;
        },
        "attr":function(){
            if(arguments.length>1){
                obj.setAttribute(arguments[0],arguments[1])
            }
            return obj.getAttribute(arguments[0]);
        },
        "css":function(){
            if(isclass){
                for (var i = 0; i < obj.length; i++) {
                    if(arguments.length==2){
                        obj[i].style[arguments[0]]=arguments[1]
                    }
                };
                return obj[0].style[arguments[0]];
            }else{
                if(arguments.length==2){
                    obj.style[arguments[0]]=arguments[1]
                }
                return obj.style[arguments[0]];
            }
        },
        "html":function(){
            if(arguments[0]!=undefined){
                obj.innerHTML=arguments[0];
            }
            return obj.innerHTML;

        }
    }
    return jquery;   
}

//后台功能,用于前台背景控制
var AdJsServerController = {
    //adpage: ADPag对象
    //session: 该页面的唯一标示
    mainFunction : function(){
        var adpage=JSON.parse(AdInterface.getCurrentPlay());
        var info=AdInterface.getPhoneInfo();
        var clientParams=eval("("+info+")");
        appver=clientParams['appver'];
        this.common.setItem("phoneInfo",info);

        var name=adpage['name'];
        var params=name!='SearchViewController'?adpage['params']:{}
        var ad_screen=adpage['screen'].split('X');
        clientParams['width']=ad_screen[0];
        clientParams['height']=ad_screen[1];

        var allads=AdInterface.getDataCache("allads");
        if(typeof(allads)=="string" && allads!="undefined"){
            var allads=JSON.parse(allads);
            AdJsServerController.getadData(allads);
            AdInterface.setDataCache("allads","undefined");
        }
        var loading_ad=this.getLoading(clientParams,name,params);
        console.log(loading_ad)
        if(loading_ad!=false){
            loading_ad['dataApi']=dataApi;//广告报数据地址
            loading_ad['params']['videoid']=adpage['params']['videoId'];

            if(loading_ad['type']=='fullscreen'){
                adInfo=loading_ad;
                this.init()
            }else{
                AdInterface.showAds(JSON.stringify(loading_ad));
            }
        }else{
            AdInterface.noAds();
        }
        /*if(type=='contentad'){
            this.getContentAd(session,clientParams);
        }*/
    },
    setClientPramUrl:function(clientParams){
        var url=new Array();
        for (var key in clientParams) {
            url.push(key+"="+encodeURIComponent(clientParams[key]));
        }
        return url.join("&");
    },
    getadData:function(str){
        var time=new Date();
        var timeExpires=time.getTime().toString();
        //loading 广告
        loadData={'loading':[]}; 
        if(Object.prototype.toString.call(str['DATA']['LOADING'])=='[object Object]'){
            for (var key in str['DATA']['LOADING']) {
                str['DATA']['LOADING'][key]['ORDERID']=key;
                str['DATA']['LOADING'][key]['PARAMS']=this.paramsToJson(str['DATA']['LOADING'][key]['PARAMS']);
                loadData['loading'].push(str['DATA']['LOADING'][key]);
            }
        }
        if(str['DATA']['MCAS_LOADING']!=undefined && str['DATA']['MCAS_LOADING']['ORDERID']!=undefined){
            loadData['loading'].push(str['DATA']['MCAS_LOADING'])
        } 
        if(str['DATA']['CHANGCEVIDEO']!=undefined && str['DATA']['CHANGCEVIDEO']['ORDERID']!=undefined){
            loadData['loading'].push(str['DATA']['CHANGCEVIDEO'])
        }
        if(str['DATA']['MADHOUSE_IMG']!=undefined && str['DATA']['MADHOUSE_IMG']['ORDERID']!=undefined){
            loadData['loading'].push(str['DATA']['MADHOUSE_IMG'])
        }
        loadData['adchina']=str['DATA']['ADCHINA'];
        loadData['adchina_video']=str['DATA']['ADCHINA_VIDEO'];
        loadData['adtouch']=str['DATA']['ADTOUCH'];
        loadData['admob']=str['DATA']['ADMOB'];
        console.log(JSON.stringify(str['DATA']['CHANGCEVIDEO']))
        loadData['bailin_loading']=str['DATA']['BAILIN_LOADING'];
        this.common.setItem('loading',JSON.stringify(loadData));
        this.common.setItem('loading_expires',timeExpires);
        this.common.setItem('loading_index',"0");


        //开机图广告
        if(Object.prototype.toString.call(str['DATA']['STARTLOADING'])=='[object Object]'){
            if(str['DATA']['STARTLOADING']['ICON']!=undefined){
                var resData=str['DATA']['STARTLOADING'];
                resData['STATISTURL']=str['DATA']['STATISTURL']
                this.common.setItem('startloading',JSON.stringify(resData));
            }
        }
        
        var resData=str['DATA'];
    
        var bannerData=new Array();
        var dopool_banner={};
        if(!this.isEmpty(resData['BANNER_V2']) && Object.prototype.toString.call(resData['BANNER_V2'])=='[object Object]'){
            for (var key in resData['BANNER_V2']) {
                resData['BANNER_V2'][key]['ORDERID']=key;
                resData['BANNER_V2'][key]['PARAMS']=this.paramsToJson(resData['BANNER_V2'][key]['PARAMS']);
                bannerData.push(resData['BANNER_V2'][key]);
            };
        }
        dopool_banner['type']='banner';
        dopool_banner['data']=bannerData;
        this.common.setItem('banner',JSON.stringify(dopool_banner));
        this.common.setItem('banner_expires',timeExpires);
        this.common.setItem('banner_index',"0");
    },
    paramsToJson:function(params){
        var data = params.split("&");
        var res = {};
        for(var i=0, iLoop = data.length; i<iLoop; i++)
        {
            var tmp = data[i].split("=");
            res[tmp[0]] = tmp[1];
        }
        return res;
    },
    checkDayNum:function(data,index,adDate){
        var dayNum=this.common.getItem("dayNum");
        var res=true;
        if(typeof(dayNum)=="string" && dayNum!=="undefined"){
            var dayNumObj=JSON.parse(dayNum);
            if(typeof(dayNumObj[adDate])!=="undefined"){
                var orderDayNum=dayNumObj[adDate][data[index]['ORDERID']];
                if(orderDayNum!=="undefined" && data[index]['DAY_NUM']>0 && orderDayNum>=data[index]['DAY_NUM']){
                    res=true;
                }else{
                    res=false;
                }
            }else{
                var dayNumStr='{"'+adDate+'":{}}';
                this.common.setItem("dayNum",dayNumStr);
                res=false;
            }
        }else{
            var dayNumStr='{"'+adDate+'":{}}';
            this.common.setItem("dayNum",dayNumStr);
            res=false;
        }
        return res;
    },
    getMadhouseImg:function(){
        var info = this.common.getItem("phoneInfo");
        var adpage=JSON.parse(AdInterface.getCurrentPlay());
        var ad_screen=adpage['screen'].split('X');
        var width=ad_screen[0];
        var height=ad_screen[1];


        var clientParams = eval("(" + info + ")");
        var time = new Date();
        var now = parseInt(time.getTime()/1000);
        var bid = madhouseAid+now+"0001";
        var adspaceid=madhouseAid;
        var pid=310;
        var apitype=2;
        var adtype=2;
        var pkgname="dopool.player";
        var appname=encodeURIComponent("CIBN手机电视");
        var conn;
        var net=clientParams['net'].toLowerCase();
        switch(net){
            case 'wifi': conn=1;break;
            case '2g' : conn=2;break;
            case '3g' : conn=3;break;
            case '4g' : conn=4;break;
            default : conn=1;
        }
        var carrier="0";
        var idfa=clientParams['idfa'];
        var os=1;
        var osv=clientParams['osver'];

        //var url="http://ad.madserving.com/adcall/bidrequest?bid="+bid+"&adspaceid="+adspaceid+"&adtype="+adtype+"&pkgname="+pkgname+"&appname="+appname+"&conn="+conn+"&carrier="+carrier+"&imei="+imei+"&os="+os+"&osv="+osv+"&width="+width+"&height="+height+"&pid="+pid+"&apitype="+apitype+"&pcat=10&media=1";
        var url="http://ad.mobiletv.madserving.com/client/bidrequest?bid="+bid+"&adspaceid="+adspaceid+"&adtype="+adtype+"&pkgname="+pkgname+"&appname="+appname+"&conn="+conn+"&carrier="+carrier+"&idfa="+idfa+"&os="+os+"&osv="+osv+"&width="+width+"&height="+height+"&pid="+pid+"&apitype="+apitype+"&pcat=10&media=1";
        console.log(url); 
        res = AdInterface.getApi(url,'get','','',5);
        return res;
    },
    getLoading:function(clientParams,name,params){
        var ad=false;
        var loading_expires=this.common.getItem("loading_expires");
        var now=new Date().getTime();
        var dif=loading_expires!==undefined?now-loading_expires:0;
        var urlParams=this.setClientPramUrl(clientParams);
        var videoType=params.videoType;
        var video_id=(videoType=='0' || videoType=='11')?'vod':params.videoId;
        var url=api_url+"?a=preplay&"+urlParams+'&videoId='+video_id;
        //ClientInterface.log('adtest loading', 'before requestUrl;;url=' + url);
        var data = {};
        res = AdInterface.getApi(url,'get','','',5);
        if(typeof(res)=="string" && res!="undefined"){
            var str=JSON.parse(res);
            //处理第三方广告请求失败给数据系统上报数据
            if(str['errorData'].length >0 ){
                //ios目前不错错误log统计
            }
            if(Object.prototype.toString.call(str['successData'])=='[object Object]'){
                //处理广告展示逻辑
                data = str['successData'];
            }
        }
        if(!data){
            AdInterface.noAds();    
        }
        adType = data['TYPE'];
        if(adType=='MCAS_LOADING'){
            if(data['DATA']['returncode']==200){
                var mcasData=data['DATA']['adList'][0];
                var videoUrl=mcasData['video_url']
                var v_dur=mcasData['v_dur'];
                var location_type=mcasData['cli_type']-1;
                var mcas_params=data['PARAMS'];
                var location=mcasData['click_url'][0];
                mcasData['click_url'].shift();
                var impr_url=mcasData['track_url'];
                var click_url=mcasData['click_url']; 
                var ad={
                    //广告类型video(视频)
                    "type":"video",
                    //视频广告播放地址
                    "videoUrl":videoUrl,
                    //展示时长
                    "timeout": v_dur,
                    //上报展示、点击数据拼接的参数
                    "params":mcas_params,
                    //跳转链接
                    "location":location, 
                    //apk名称
                    "app_name":app_name,
                    //是否可以取消下载1可以、0不可以
                    "app_iscancel":app_iscancel,
                    //点击跳转类型
                    "location_type":location_type,
                    //是否跳过1可以跳过，0不可以
                    "close":data['CLOSE'],
                    //点击描述
                    "hitDesc":'了解详情',
                    //是否可以全屏点击 1可以，0不可以
                    "fullscreen_click":1,
                    //第三方展示
                    "impr_url":impr_url,
                    //第三方点击
                    "click_url":click_url,
                }
            } 
        }
        else if(adType=='MADHOUSE_IMG'){
            //亿动前贴片广告
            var madhouseData = data['DATA']; //当前订单
            data['ICON']=madhouseData[madhouseAid]['imgurl'];
            data['LOCATION']=madhouseData[madhouseAid]['clickurl'];
            data['IMPR_URL']=madhouseData[madhouseAid]['imgtracking'];
            data['CLICK_URL']=madhouseData[madhouseAid]['thclkurl'];
            var ad = {
                "dataApi": dataApi,
                "type": "fullscreen",//loading
    //            "timeout": 5,
                "duration":data["DURATION"],
                "params": this.paramsToJson(data["PARAMS"]),
                "icon": data["ICON"],
                "location": data["LOCATION"],
                "location_type":data["LOCATION_TYPE"],
                "close": data["CLOSE"].toString(), //是否跳过广告
                "width":clientParams['width'],
                "height":clientParams['height'],
                "impr_url":data["IMPR_URL"]!=undefined?data["IMPR_URL"]:[],
                "click_url":data["CLICK_URL"]!=undefined?data["CLICK_URL"]:[]
            };
        }else if(adType=='ADSAGE_LOADING'){
            //艾德思齐前贴片广告
            var adData=data['DATA'];
            var nws;
            var net=clientParams['net'].toLowerCase();
            switch(net){
                case 'wifi': nws=1;break;
                case '2g' : nws=2;break;
                case '3g' : nws=3;break;
                case '4g' : nws=4;break;
                default : nws=0;
            }
            data['LOCATION_TYPE']='0'; //测试
            adData = adData['ad']['ad_info'];

            data['ICON']=adData['img_url'];
            data['LOCATION']=adData['lpg_url'];
            data['dws_url']=adData['dws_url'];
            data['dwe_url']=adData['dwe_url'];
            data['inst_url']=adData['inst_url'];
            data['APP_NAME']=adData['apak_name'];
            data['IMPR_URL']=adData['pv_url']==undefined?"":adData['pv_url'];//第三方曝光监控
            data['CLICK_URL']=adData['cli_url']==undefined?"":adData['cli_url'];//第三方点击监控
            data['NWS']=nws;//上报参数 联网类型
            var ad = {
                "dataApi": dataApi,
                "type": 'fullscreen',//loading
                "dws_url":data['dws_url'],
                "dwe_url":data['dwe_url'],
                "inst_url":data['inst_url'],
                "APP_NAME":data['APP_NAME'],
                "NWS":data['NWS'],
                "duration":data["DURATION"],
                "params": this.paramsToJson(data["PARAMS"]), //测试
                "icon": data["ICON"],
                "location": data["LOCATION"],
                "location_type":data["LOCATION_TYPE"],
                "close": data["CLOSE"], //是否跳过广告
                "width":clientParams['width'],
                "height":clientParams['height'],
                "impr_url":data["IMPR_URL"]!=undefined?data["IMPR_URL"]:[],
                "click_url":data["CLICK_URL"]!=undefined?data["CLICK_URL"]:[]
            };
        }else if(adType=='INMOBI_LOADING'){
            var inmobiData = data['DATA']['ads'][0];
            var inmobiInfo = Base64.decode(inmobiData['pubContent']);
            inmobiInfo = JSON.parse(inmobiInfo);
            var ad={
                "type":"fullscreen",
                "icon":inmobiInfo['screenshots']['url'],
                "location":inmobiInfo['landingURL'],
                "location_type":inmobiInfo['cta'] == 'Install' ? 1 : 0,//点击后跳转类型 0：网页 1：下载
                "duration": data['DURATION'],//展示时长
                "orderid":'INMOBI_LOADING',
                "width":clientParams['width'],
                "height":clientParams['height'],
//                        "timeout":data['DURATION'],
                "params":data['PARAMS'],
                "app_name":parseInt(Math.random())+'.apk', //应用名称
                "app_iscancel":0, //是否强制下载
                //旧版
                "custom_show":data['CUSTOM_SHOW']==undefined?0:data['CUSTOM_SHOW'],
                "custom_click":data['CUSTOM_CLICK']==undefined?0:data['CUSTOM_CLICK'],
                //第三方展示
                "impr_url":inmobiData['eventTracking']['18']['urls'] ? inmobiData['eventTracking']['18']['urls'] : [], 
                //第三方点击
                "click_url":inmobiData['eventTracking']['8']['urls'] ? inmobiData['eventTracking']['8']['urls'] : []
            }

        }else{
            var icon=data['X_ICON'];
            var location=data['LOCATION'];
            var location_type=data['LOCATION_TYPE'];
            var app_name="";
            var app_iscancel="0";
            console.log(data)
            if(location!=""){
                var aQuery = location.split("?");  //取得Get参数
                var aGet = new Array();
                if(aQuery.length > 1)
                {
                    var aBuf = aQuery[1].split("&");
                    for(var i=0, iLoop = aBuf.length; i<iLoop; i++)
                    {
                        var aTmp = aBuf[i].split("=");  //分离key与Value
                        aGet[aTmp[0]] = aTmp[1];
                    }
                }
                if(location_type=="0"){
                    location=decodeURIComponent(aGet['location']);
                    
                }else{
                    location=decodeURIComponent(aGet['app_url']);
                    app_name=aGet['app_url_name'];
                    app_iscancel=aGet['app_iscancel'];
                }
            }
            if( data['TYPE']=='VIDEO'){
                if(clientParams['osver']>="4.0" && data['VIDEOURL_FLV']!=""){
                    var videoUrl=data['VIDEOURL_FLV'];
                }else{
                    var videoUrl=data['VIDEOURL']
                }

                var ad={
                    //广告类型video(视频)
                    "type":"video",
                    //视频广告播放地址
                    "videoUrl":videoUrl,
                    //展示时长
                    "timeout": data['DURATION'],
                    //上报展示、点击数据拼接的参数
                    "params":data['PARAMS'],
                    //跳转链接
                    "location":location, 
                    //apk名称
                    "app_name":app_name,
                    //是否可以取消下载1可以、0不可以
                    "app_iscancel":app_iscancel,
                    //点击跳转类型
                    "location_type":location_type,
                    //是否跳过1可以跳过，0不可以
                    "close":data['CLOSE'],
                    //点击描述
                    "hitDesc":data['HITDESC'],
                    //是否可以全屏点击 1可以，0不可以
                    "fullscreen_click":data['FULLSCREEN_CLICK'],
                    //第三方展示
                    "impr_url":data['IMPR_URL']?data['IMPR_URL']:[], 
                    //第三方点击
                    "click_url":data['CLICK_URL']?data['CLICK_URL']:[], 
                }
            }else if(icon!=''){
                var ad={
                    "type":"fullscreen",
                    "icon":icon,
                    "location":location,
                    "location_type":location_type,//点击后跳转类型 0：网页 1：下载
                    "duration": data['DURATION'],//展示时长
                    "orderid":orderid,
                    "width":clientParams['width'],
                    "height":clientParams['height'],
//                        "timeout":data['DURATION'],
                    "params":data['PARAMS'],
                    "app_name":app_name, //应用名称
                    "app_iscancel":app_iscancel, //是否强制下载
                    //旧版
                    "custom_show":data['CUSTOM_SHOW']==undefined?0:data['CUSTOM_SHOW'],
                    "custom_click":data['CUSTOM_CLICK']==undefined?0:data['CUSTOM_CLICK'],
                    
                    
                    //第三方展示
                    "impr_url":data['IMPR_URL']?data['IMPR_URL']:[], 
                    //第三方点击
                    "click_url":data['CLICK_URL']?data['CLICK_URL']:[], 

                }
            }
        }
        return ad;
    },
    isEmpty:function(obj){
        for (var name in obj){
            return false;
        }
        return true;
    },
    appverToNum:function(appver){
        var appverArr=appver.replace(".", "");
        res=appverArr[0]+'.'+appverArr.substr(1,appverArr.length);
        return parseFloat(res);
    },
    common:{
        "getItem":function(key){
            key=appver+"_"+key;
            var res;
            if(typeof(AdInterface)!="undefined" && "setDataCache" in AdInterface){
                res=AdInterface.getDataCache(key)
                if(res=="undefined"){
                    res=undefined;
                }
            }else{
                res=localStorage.getItem(key);
            }
            return res;
        },
        "setItem":function(key,value){
            key=appver+"_"+key;
            if(typeof(AdInterface)!="undefined" && "setDataCache" in AdInterface){
                res=AdInterface.setDataCache(key,value);
            }else{
                res=localStorage.setItem(key,value);
            }
        },
        "removeItem":function(key){
            key=appver+"_"+key;
            if(typeof(AdInterface)!="undefined" && "setDataCache" in AdInterface){
                AdInterface.removeDataCache(key);
            }else{
                localStorage.removeItem(key);
            }
        }
    },
    downloadapp:function(){
        var now=new Date().getTime();
        var cloud = arguments[0]?arguments[0]:0;
        var url=$("#ad_location").val();
        var app_name=$("#app_name").val();
        var app_iscancel=$("#app_iscancel").val();
        if(url==""){
            return false;
        }
        
        //$("#order_params").val()
        var adParams=adInfo['params'];
       
        var location_type=$("#location_type").val();
        if(thirdTrack['adchina_click']!=undefined){
            var script = document.createElement('script');
            script.src = thirdTrack['adchina_click']
            document.body.appendChild(script);
        }
        
        if(thirdTrack['click']!=undefined){
            for(x in thirdTrack['click']){
                var script = document.createElement('script');
                script.src = thirdTrack['click'][x]
                document.body.appendChild(script);
            }
        }

        if(thirdTrack['adchina_click']!=undefined ){
            AdInterface.sendAdData(dataApi,'adclick',JSON.stringify(adParams));
        }

        if(adInfo['click_url']!=undefined){
            for(cval in adInfo['click_url']){
                var script = document.createElement('script');
                var clickUrl = adInfo['click_url'][cval].replace("$TS",now);
                script.src = clickUrl;
                document.body.appendChild(script);
            }
        }
        var orderid=$("#orderid").val()
        
        if(location_type==="0" ){
            if(orderid!='adchina'){
                AdInterface.sendAdData(dataApi,'adclick',JSON.stringify(adParams));
                this.openUrl(url,cloud)
            }else{
                this.openUrl(url,cloud)
            }
        }else{
            AdInterface.sendAdData(dataApi,'adclick',JSON.stringify(adParams));
            if(cloud===0){
                if(app_iscancel=='1'){
                    AdInterface.forcedDownloadApp(url,app_name);
                }else{
                    AdInterface.downloadApp(url,app_name);
                }
            }
            
        }
        if(cloud===0){
            AdInterface.hide('click')
        }
    },
    openUrl:function(url,cloud){
        if(cloud>0){
            this.sendUrl(url);
        }else{
            AdInterface.openNewTablet('',url,20000*1);    
        }
    },
    adexposure:function(adParams){
        var now=new Date().getTime();
        if(adParams['thirdshow']!=undefined){
            thirdShow=window.atob(adParams['thirdshow']);
            this.sendUrl(thirdShow)
            delete adParams['thirdshow'];
        }
        AdInterface.sendAdData(dataApi,'adexposure',JSON.stringify(adParams));
        if(thirdTrack['adchina_show']!=undefined){
            var script = document.createElement('script');
            script.src = thirdTrack['adchina_show']
            document.body.appendChild(script);
        }
        if(thirdTrack['show']!=undefined){
            for(x in thirdTrack['show']){
                var script = document.createElement('script');
                script.src = thirdTrack['show'][x]
                document.body.appendChild(script);
                //this.sendUrl(thirdTrack['show'][x])
            }
        }
        if(adInfo['impr_url']!=undefined){
            for(imp in adInfo['impr_url']){
                var script = document.createElement('script');
                var impUrl = adInfo['impr_url'][imp].replace("$TS",now);
                script.src = impUrl;
                document.body.appendChild(script);
            }
        }
    },
    sendUrl:function(url){
        try{
            //$.getJSON(url)
            var script = document.createElement('script');
            script.src = url;
            document.body.appendChild(script);
        }catch(e){
            //console.log(e.message());
        }
    },
    init:function() {
        AdJsServerController.adjustWindowSize();
        var r_length;
        var startICON_time = new Date().getTime();
        var img = new Image();
        img.onload =  function(){
            AdJsServerController.startShow();
        };
        img.onerror = function(){};
        img.onclick = function(){
            AdJsServerController.downloadapp();
        };

        img.classList.add('poster');
        img.src = adInfo['icon'];
        document.getElementById('ad_img_wrapper').appendChild(img);

        $("#ad_location").val(adInfo['location']);
        $("#app_name").val(adInfo['app_name']);
        $("#app_iscancel").val(adInfo['app_iscancel']);

        $("#location_type").val(adInfo['location_type']);
        $("#orderid").val(adInfo['orderid']);
        if(AdJsServerController.appverToNum(appver)>=AdJsServerController.appverToNum(minAppver))
        {
            $("#vip_div").css('display','block')
        }
        window.addEventListener(('onorientationchange' in window ? 'orientationchange' : 'resize'), AdJsServerController.adjustWindowSize, false);
    },
    adjustWindowSize: function(){
        /*
        # 展示广告图片
        */
        var screen = JSON.parse(AdInterface.getCurrentPlay()).screen.split('X');
        var w = parseInt(screen[0]);
        var h = parseInt(screen[1]);
        if(h > w){
            adInfo.height = Math.floor(h / 3);
            adInfo.width = w;
        }else{
            adInfo.height = h;
            adInfo.width = w;
        }
        $("#con_div").css('width',adInfo['width']+"px");
        $("#con_div").css('height',adInfo['height']+"px");

        /*
        ## 广告倒计时 start
        */
        $("#float_div").css('width',adInfo['height']/8+"px");
        $("#float_div").css('height',adInfo['height']/8+"px");
        $("#float_div").css('display','block');
        $("#float_div").css('margin',adInfo['height']/15+"px");

        // $("#vip_div").css('width',(adInfo['height']/8)*2+"px");
        // $("#vip_div").css('height',adInfo['height']/8+"px");
        // $("#vip_div").css('margin',adInfo['height']/15+"px");
        // $("#vip_div").css('margin-right',(adInfo['height']/15)*3.5+"px");
        // $("#vip_div").css('line-height',adInfo['height']/8+"px");
        // $("#vip_img").css('width',(adInfo['height']/8)*2+"px");
        // $("#vip_img").css('height',adInfo['height']/8+"px");


        $("#backImg").css('width',adInfo['height']/8+"px");
        $("#backImg").css('height',adInfo['height']/8+"px");

        $(".back").css('width',adInfo['height']/8+"px");
        $(".back").css('height',adInfo['height']/8+"px");
        $(".back").css('display','block');
        $(".back").css('margin',adInfo['height']/15+"px");

        $(".timer").css('width',adInfo['height']/8+"px");
        $(".timer").css('height',adInfo['height']/8+"px");
        $(".timer").css('line-height',adInfo['height']/8+"px");
    },
    setTimer:function(timer){
        $("#timer").html(timer);
        if(timer>0){
            setTimeout(AdJsServerController._timer(timer),1000);
        }else{
            AdInterface.hide()
        }
    },

    _timer:function(timer)
    {
        return function()
        {
            AdJsServerController.setTimer(timer-1);
        }
    },
    goback:function(){
        AdInterface.back();
    },
    startShow:function(){
        if(adInfo==undefined){
            return false;
        }
        show_time=parseInt(adInfo['duration'])
        AdJsServerController.setTimer(show_time);
        /*
        ## 上报广告展示数据
        */
        var adexParams=adInfo['params'];
        //console.log(adexParams);
        $("#order_params").val(JSON.stringify(adexParams));
        var track=adInfo['third_track'];
        if(track!=undefined){
            track=eval("("+track+")");
            if(track['tracking']!=undefined && track['type']=='adchina'){
                for(x in track['tracking'] ){  
                    if(track['tracking'][x]['et']=='216'){
                        thirdTrack['show']=track['tracking'][x]['tku'];
                    }else if(track['tracking'][x]['et']=='214'){
                        thirdTrack['click']=track['tracking'][x]['tku'];
                    }
                }
                thirdTrack['adchina_show']=track['btu']+"&et=216";
                thirdTrack['adchina_click']=track['btu']+"&et=214&pst=20%2c30";
            }
        }
        AdJsServerController.adexposure(adexParams)

        var custom_show=adInfo['custom_show'];
        var custom_click=adInfo['custom_click'];
        if(custom_show>0){
            var rand=Math.ceil(Math.random()*1000)
            if(rand<=custom_show){
                ctime=Math.floor(Math.random()*show_time)
                setTimeout(function(){AdJsServerController.adexposure(adexParams)},1000*ctime);
            }
        }
        if(custom_click>0){
            var rand=Math.ceil(Math.random()*1000)
            if(rand<=custom_click){
                ctime=Math.floor(Math.random()*show_time)
                setTimeout(function(){downloadapp(1)},1000*ctime);
            }
        }
        AdInterface.show();
        
    }
}
var Base64 = {
    // private property
    _keyStr : "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
 
    // public method for encoding
    encode : function (input) {
        var output = "";
        var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
        var i = 0;
 
        input = Base64._utf8_encode(input);
 
        while (i < input.length) {
 
            chr1 = input.charCodeAt(i++);
            chr2 = input.charCodeAt(i++);
            chr3 = input.charCodeAt(i++);
 
            enc1 = chr1 >> 2;
            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
            enc4 = chr3 & 63;
 
            if (isNaN(chr2)) {
                enc3 = enc4 = 64;
            } else if (isNaN(chr3)) {
                enc4 = 64;
            }
            output = output +
            this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) +
            this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);
 
        }
        return output;
    },
    // public method for decoding
    decode : function (input) {
        var output = "";
        var chr1, chr2, chr3;
        var enc1, enc2, enc3, enc4;
        var i = 0;
        input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
        while (i < input.length) {
            enc1 = this._keyStr.indexOf(input.charAt(i++));
            enc2 = this._keyStr.indexOf(input.charAt(i++));
            enc3 = this._keyStr.indexOf(input.charAt(i++));
            enc4 = this._keyStr.indexOf(input.charAt(i++));
 
            chr1 = (enc1 << 2) | (enc2 >> 4);
            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
            chr3 = ((enc3 & 3) << 6) | enc4;
            output = output + String.fromCharCode(chr1);
            if (enc3 != 64) {
                output = output + String.fromCharCode(chr2);
            }
            if (enc4 != 64) {
                output = output + String.fromCharCode(chr3);
            }
        }
        output = Base64._utf8_decode(output);
        return output;
    },
    // private method for UTF-8 encoding
    _utf8_encode : function (string) {
        string = string.replace(/\r\n/g,"\n");
        var utftext = "";
        for (var n = 0; n < string.length; n++) {
            var c = string.charCodeAt(n);
            if (c < 128) {
                utftext += String.fromCharCode(c);
            }
            else if((c > 127) && (c < 2048)) {
                utftext += String.fromCharCode((c >> 6) | 192);
                utftext += String.fromCharCode((c & 63) | 128);
            }
            else {
                utftext += String.fromCharCode((c >> 12) | 224);
                utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                utftext += String.fromCharCode((c & 63) | 128);
            }
        }
        return utftext;
    },
 
    // private method for UTF-8 decoding
    _utf8_decode : function (utftext) {
        var string = "";
        var i = 0;
        var c = c1 = c2 = 0;
        while ( i < utftext.length ) {
            c = utftext.charCodeAt(i);
            if (c < 128) {
                string += String.fromCharCode(c);
                i++;
            }
            else if((c > 191) && (c < 224 )) {
                c2 = utftext.charCodeAt(i+1);
                string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
                i += 2;
            }
            else {
                c2 = utftext.charCodeAt(i+1);
                c3 = utftext.charCodeAt(i+2);
                string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
                i += 3;
            }
        }
        return string;
    }
}



//返回上一页


AdJsServerController.mainFunction();
</script>
</html>


